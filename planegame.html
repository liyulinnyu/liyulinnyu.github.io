<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=0.25,maximum-scale=0.25,user-scalable=0">
	<title></title>
	<link rel="stylesheet" href="">

	<style>
	body,html{
    	overflow-y: hidden;
	}
	#canvasone{
		position: absolute;
		left:0;
		top:0;
		background: #000;
		z-index: 1;
	}
	#bullet{
		position: absolute;
		left:0;
		width:300px;
		height:300px;
		border-radius: 150px;
		background: #333;
		opacity: 0.8;
		filter:alpha(opacity=80);
		font-size: 100px;
		line-height: 300px;
		text-align: center;
		color:#999;
		z-index: 2;
	}
	#missle{
		position: absolute;
		width:200px;
		height:200px;
		border-radius: 100px;
		background: #333;
		opacity: 0.8;
		filter:alpha(opacity=80);
		font-size: 100px;
		line-height: 200px;
		text-align: center;
		color:#999;
		z-index: 2;
	}
	#atom{
		position: absolute;
		width:200px;
		height:200px;
		border-radius: 100px;
		background: #333;
		opacity: 0.8;
		filter:alpha(opacity=80);
		font-size: 100px;
		line-height: 200px;
		text-align: center;
		color:#999;
		z-index: 2;
	}
	#blooddiv{
		position: absolute;
		left:350px;
		height: 100px;
		background: red;
		text-align: center;
		color:#fff;
		line-height: 100px;
		font-size:50px;
		z-index: 2;
	}
	</style>

</head>
<body>
	

	<script>

	(function(){

		var totalwidth = window.innerWidth;    
		var totalheight = window.innerHeight;

		var createCanvas = "<canvas id='canvasone' width='" + totalwidth + "px' height='" + totalheight + "px'></canvas>";
		document.body.insertAdjacentHTML("beforeEnd", createCanvas);
		var theCanvas = document.querySelector("#canvasone");
		var context = theCanvas.getContext("2d");


////////////////////////////////////////////////////////// 相关参数//////////////////////////////////////////////////////
		var gameloop = null;
		var starttime = "",      // 开始时间
			endtime = "";        // 结束时间

		// 游戏对象
		var maxcirclenum = 15;
		var circleinterval = 0;      // 创建小球的间隔时间
		var totalcircle = [];
		function whiteCircle(x, y, r, speed){
			this.x = x;
			this.y = y;
			this.r = r;
			this.speed = speed;
		}

		// 飞机对象
		var planeimg1 = new Image();
		planeimg1.src = "gameimg/planegame/plane1.png";
		//var planeimg2 = new Image();
		//planeimg2.src = "gameimg/planegame/plane2.png";
		var fireimg = new Image();
		fireimg.src = "gameimg/planegame/fire.png";
		var fireinterval = 0;       // 点火间隔

		var Plane = {
			x : totalwidth/2,
			y : totalheight - 250,   // 到底部250px
			dir : 0,                // 0向左，1向右
			addspeedx : 0,              // 初始速度
			addspeedy : 0,
			r : 100,                  // 飞机大小  
			blood : 100
			// atk, def 
		};

		// 子弹，导弹，原子弹数组, 对象
		var totalbullet = [],
			totalmissle = [],
			totalatom = [];

		function AllBullet(x, y, speed){
			this.x = x;
			this.y = y;
			this.speed = speed;
		}

////////////////////////////////////////////////////// 控制面板 ////////////////////////////////////////////////////////
		var bulletdiv = "<div id='bullet'>B</div>",
			misslediv = "<div id='missle'>M</div>",
			atomdiv = "<div id='atom'>A</div>";

		document.body.insertAdjacentHTML("beforeEnd", bulletdiv);
		document.body.insertAdjacentHTML("beforeEnd", misslediv);
		document.body.insertAdjacentHTML("beforeEnd", atomdiv);

		// 调整子弹div特效
		bulletdiv = document.querySelector("#bullet");
		bulletdiv.style.top = (totalheight - 300) + "px";
		bulletdiv.addEventListener("touchstart", function(event){
			event.target.style.background = "#fff";
			event.target.style.color = "#333";
			event.target.style.opacity = "0.8";
		}, false);
		bulletdiv.addEventListener("touchend", function(event){
			event.target.style.background = "#333";
			event.target.style.color = "#999";
			event.target.style.opacity = "0.8";
		}, false);
		bulletdiv.addEventListener("click", function(event){
			totalbullet.push(new AllBullet(Plane.x - 60, Plane.y + 10, 20));  // 左边子弹
			totalbullet.push(new AllBullet(Plane.x + 60, Plane.y + 10, 20));  // 右边子弹
		}, false);   // 加子弹


		// 调整导弹div特效
		misslediv = document.querySelector("#missle");
		misslediv.style.top = (totalheight - 200) + "px";
		misslediv.style.left = (totalwidth - 200) + "px";
		misslediv.addEventListener("touchstart", function(event){
			event.target.style.background = "#336699";
			event.target.style.color = "#fff";
			event.target.style.opacity = "0.8";
		}, false);
		misslediv.addEventListener("touchend", function(event){
			event.target.style.background = "#333";
			event.target.style.color = "#999";
			event.target.style.opacity = "0.8";
		}, false);


		// 调整原子弹div特效
		atomdiv = document.querySelector("#atom");
		atomdiv.style.top = (totalheight - 450) + "px";
		atomdiv.style.left = (totalwidth - 200) + "px";
		atomdiv.addEventListener("touchstart", function(event){
			event.target.style.background = "red";
			event.target.style.color = "#fff";
			event.target.style.opacity = "0.8";
		}, false);
		atomdiv.addEventListener("touchend", function(event){
			event.target.style.background = "#333";
			event.target.style.color = "#999";
			event.target.style.opacity = "0.8";
		}, false);

/////////////////////////////////////////////////////////// 飞机血条，导弹数量等参数 /////////////////////////////////////

		var blooddiv = "<div id='blooddiv'>100 / 100</div>";
		document.body.insertAdjacentHTML("beforeEnd", blooddiv);

		blooddiv = document.querySelector("#blooddiv");
		blooddiv.style.width = (totalwidth - 600) + "px";
		blooddiv.style.top = (totalheight - 100) + "px";

/////////////////////////////////////////////////////////// start game/////////////////////////////////////////////////////////

		window.addEventListener("load", canvasApp, false);
		window.addEventListener("deviceorientation", changePlanePosition, false);

		function canvasApp(){

			function drawScreen(){

				// 初始化背景
				drawBackground();

				// 画玩家位置
				drawPlane();

				// 画子弹位置
				drawBullet();
			}

			gameloop = setInterval(drawScreen, 20);
		}


		function drawBackground(){

			context.clearRect(0, 0, totalwidth, totalheight);     // 清理屏幕
			if (circleinterval > 50){
				circleinterval = 0;
				createCircle();
			}else{
				circleinterval++;
			}
			// 画白球
			for (var i = 0; i < totalcircle.length; i++){
				var thiscircle = totalcircle[i];
				context.beginPath();
				context.fillStyle = "#333";
				context.arc(thiscircle.x, thiscircle.y, thiscircle.r, 0, 2*Math.PI, true);
				context.fill();
				context.closePath();
				// 纵向移动
				thiscircle.y += thiscircle.speed;
				// 超过屏幕则删除
				if (thiscircle.y >= totalheight){
					totalcircle.splice(i, 1);
					i--;
				}
			}
		}

		function createCircle(){

			if (totalcircle.length < maxcirclenum){
				var tempx = Math.random()*totalwidth,
					tempy = 0;
					tempr = Math.random()*5 + 2,
					tempspeed = 2;

				totalcircle.push(new whiteCircle(tempx, tempy, tempr, tempspeed));
			}
		}

		function drawPlane(){

			context.beginPath();
			// 画飞机
			context.drawImage(planeimg1, Plane.x-Plane.r, Plane.y-Plane.r, 2*Plane.r, 2*Plane.r);
			// 画喷火
			if ((fireinterval > 90 && fireinterval < 100) || (fireinterval > 120 && fireinterval < 130)){
				context.drawImage(fireimg, Plane.x-Plane.r, Plane.y+Plane.r, 2*Plane.r, Plane.r/2);
				fireinterval++;
			}else if(fireinterval > 130){
				fireinterval = 0;
			}else{
				fireinterval++;
			}
			context.closePath();
		}


		// 根据移动设备转向，变换飞机位置
		function changePlanePosition(event){
 			/* 
			*	beta > 0 手机向前旋转 (0~180)
			*	beta < 0 手机向后旋转 (-180~0)
			*	gamma > 0 手机水平向右翻转 (0~90)
			*	gamma < 0 手机水平向左翻转 (-90~0)
			*	在取值的时候取整数即可，不然对于用户使用太敏感
			*   alert(event.beta+" " +event.gamma);
			*/
			Plane.addspeedx = parseInt(event.gamma);
			Plane.addspeedy = parseInt(event.beta);
			if (Plane.addspeedx < 0){
				Plane.x = (Plane.x - Plane.r) <= 0 ? Plane.r : (Plane.x + Plane.addspeedx);
			}else{
				Plane.x = (Plane.x + Plane.r) >= totalwidth ? (totalwidth - Plane.r) : (Plane.x + Plane.addspeedx);
			}

			if (Plane.addspeedy < 0){
				Plane.y = (Plane.y - Plane.r) <= 0 ? Plane.r : (Plane.y + Plane.addspeedy);
			}else{
				Plane.y = (Plane.y + Plane.r + 100) >= totalheight ? (totalheight - Plane.r - 100) : (Plane.y + Plane.addspeedy);
			}
		}


		// 画子弹位置
		function drawBullet(){

			
			for (var i = 0; i < totalbullet.length; i++){
				var tempbullet = totalbullet[i];
				context.beginPath();
				context.fillStyle = "#eee";
				context.arc(tempbullet.x, tempbullet.y, 5, 0, 2*Math.PI, true);
				context.fill();
				context.closePath();
				tempbullet.y -= tempbullet.speed;
				if (tempbullet.y <= 0){
					totalbullet.splice(i, 1);
					i--;
				}
			}
			
		}

	})();


	</script>

</body>
</html>