<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
</head>
<style>
@media all and (max-width: 1000px){
    html, body{
        font-size: 120%;
    }
    #theCanvas{
        position: absolute;
        left:0;
        top:0;
        background: #000;
    }
}

@media all and (min-width: 1000px){
    html, body{
        font-size: 100%;
    }
    #theCanvas{
        position: absolute;
        top:0;
        background: #000;
    }
}
</style>
<body>
    

    
    <script>
    (function(){
        var totalwidth = window.innerWidth > 1000 ? 1000 : window.innerWidth;
        var totalheight = window.innerHeight/2;

        var canvas = "<canvas id='theCanvas' width='" + totalwidth +"px' height='" + totalheight + "px' ></canvas>"

        document.body.insertAdjacentHTML("beforeEnd", canvas);

        var thecanvas = document.querySelector("#theCanvas");
        var context = theCanvas.getContext("2d");

        if (totalwidth === 1000){
            // 证明是大屏
            thecanvas.style.left = (window.innerWidth - totalwidth)/2 + "px";
        }

        var text = [
            "Look Look",
            "You can see the bullet screen",
            "WooooooooooooooooW",
            "66666666",
            "哇，居然有中文",
            "한글",
            "日本語の",
            "wowo,跟着我左手右手一个慢动作",
            "NYU",
            "66666666",
            "Ineffable",
            "Ru guo ni neng du wan zhe duan ping yin, zheng ming ni shi you duo wu liao...",
            "五五开大战faker，详情请自行联想",
            "什么鬼",
            "张全蛋哈哈哈",
            "66666666"
        ];

        var colors = [
            "red",
            "blue",
            "orange",
            "#8234aa",
            "#fff",
            "#fff",
            "#fff"
        ];

        // 弹幕对象
        function Bullet(x, y, fontsize, color, speed, text){
            this.x = x;
            this.y = y;
            this.fontsize = fontsize;
            this.color = color;
            this.speed = speed;
            this.text = text;
        }

        // 储存所有弹幕对象
        var allbullet = [],
            index = 0,   // 加入到第几条
            addinterval = 0;   // 过几秒添加

        window.addEventListener("load", canvasApp, false);

        // 兼容浏览器，尤其是IE9
        window.requestAnimationFrame = (function(){  
            return  window.requestAnimationFrame       ||  
                    window.webkitRequestAnimationFrame ||  
                    window.mozRequestAnimationFrame    ||  
                    function(callback){  
                      window.setTimeout(callback, 1000 / 60);  
                    };  
        })();

        function canvasApp(){

            function drawScreen(){
                context.clearRect(0, 0, totalwidth < 1000 ? totalwidth : 1000, totalheight);
                // 加弹幕
                addBullet();
                // 渲染弹幕
                drawBullet();
                // 删除弹幕
                deleteBullet();
                // 继续动画
                requestAnimationFrame(drawScreen);
            }

            // 开始动画
            requestAnimationFrame(drawScreen);
        }

        function addBullet(){


            if (addinterval > 20){
                // add x, y, fontsize, color, speed, text
                var tempx = Math.min(totalwidth, 1000),
                    tempsize = Math.random() + 1,
                    tempy = Math.random()*totalheight + tempsize,
                    tempcolor = colors[Math.floor(Math.random()*colors.length)],
                    tempspeed = Math.random()*5 + 1,
                    temptext = text[index];
                index++;
                if (index >= text.length){
                    index = 0;
                }
                tempy = tempy + tempsize/2 > totalheight ? totalheight - tempsize : tempy;
                allbullet.push(new Bullet(tempx, tempy, tempsize, tempcolor, tempspeed, temptext));
                addinterval = 0;
            }else{
                addinterval++;
            }

        }

        function drawBullet(){

            for (var i = 0; i < allbullet.length; i++){
                var temp = allbullet[i];

                context.fillStyle = temp.color;
                context.font = temp.fontsize + "em YH";
                var text = temp.text;
                temp.width = context.measureText(text).width;   // 给弹幕对象加上width属性
                context.fillText(text, temp.x, temp.y);
                temp.x -= temp.speed;
            }
        }

        function deleteBullet(){

            for (var i = 0; i < allbullet.length; i++){
                var temp = allbullet[i];

                if (temp.x + temp.width <= 0){
                    allbullet.splice(i, 1);
                    i--;
                }
            }
        }

    })();
    </script>
    
</body>
</html>